<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex,nofollow" />
  <title>connection</title>

  <style>

@font-face {
  font-family: "DeterminationK2";
  src: url("./DeterminationSansK2.woff2") format("woff2");
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

    * {
      box-sizing: border-box;
    }
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    body {
      background: #000;
      color: #f5f5ff;
  font-family: "DeterminationK2", "Noto Sans KR", -apple-system, system-ui, sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      overflow-y: auto;
      padding: 2px 8px 8px;
    }

  body, .q-label, .q-text, .choice-btn, .choice-btn span {
  font-family: "DeterminationK2", "Noto Sans KR", -apple-system, system-ui, sans-serif !important;
}

.top-bar.topbar-hidden {
  opacity: 0;
  visibility: hidden;
}

  /* 404 효과 없음 */
.error-corner {
  position: fixed;
  top: 14px;
  left: 14px;
  margin: 0;
  padding: 0;
  max-width: calc(100vw - 28px);

  text-align: left !important;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  font-size: 16px !important;
  line-height: 1.35;

  color: #f5f5ff;
  text-shadow: none !important;
}

    /* 불안하게 깜빡 텍스트 */
.flicker {
  animation: flicker 1.4s infinite;
}

@keyframes flicker {
  0%   { opacity: 1;   text-shadow: 0 0 8px rgba(255,255,255,0.8); }
  10%  { opacity: 0.3; text-shadow: 0 0 2px rgba(255,255,255,0.4); }
  20%  { opacity: 0.8; }
  35%  { opacity: 0.2; }
  50%  { opacity: 1;   text-shadow: 0 0 14px rgba(255,255,255,1); }
  70%  { opacity: 0.4; }
  85%  { opacity: 0.9; }
  100% { opacity: 1; }
}

    /* 글리치 효과 */
.glitch {
  animation: glitch 0.6s infinite;
}

@keyframes glitch {
  0% {
    transform: translate(0, 0);
    text-shadow:
      1px 0 rgba(255, 0, 255, 0.8),
      -1px -1px rgba(0, 255, 255, 0.8);
  }
  20% {
    transform: translate(-1px, 1px);
    text-shadow:
      -2px 0 rgba(255, 0, 255, 0.6),
      2px 2px rgba(0, 255, 255, 0.6);
  }
  40% {
    transform: translate(1px, -1px);
    text-shadow:
      2px -1px rgba(255, 0, 255, 0.9),
      -2px 1px rgba(0, 255, 255, 0.9);
  }
  60% {
    transform: translate(0, 0);
    text-shadow:
      -1px 1px rgba(255, 0, 255, 0.5),
      1px -1px rgba(0, 255, 255, 0.5);
  }
  80% {
    transform: translate(1px, 0);
    text-shadow:
      2px 0 rgba(255, 0, 255, 0.7),
      -2px 0 rgba(0, 255, 255, 0.7);
  }
  100% {
    transform: translate(0, 0);
    text-shadow:
      0 0 4px rgba(255, 255, 255, 0.8);
  }
}

    /* 텍스트 자간이 좁아졌다 넓어졌다 */
.pressure-text {
  animation: pressureText 1.4s ease-in-out infinite;
}

@keyframes pressureText {
  0% {
    letter-spacing: 0em;
  }
  40% {
    letter-spacing: -0.08em;   /* 글자들이 서로 가까워짐 */
  }
  70% {
    letter-spacing: -0.03em;
  }
  100% {
    letter-spacing: 0em;
  }
}
    
    /* 인트로 */
    .intro {
      position: fixed;
      inset: 0;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }
    .intro-text {
      font-size: 25px;
      letter-spacing: 0.3em;
      color: #f5f5ff;
      text-shadow:
        0 0 8px rgba(255, 255, 255, 0.9),
        0 0 22px rgba(54, 84, 255, 0.9);
      animation: introPulse 1.2s ease-in-out infinite alternate;
    }
    @keyframes introPulse {
      from { opacity: 0.4; }
      to   { opacity: 1; }
    }
    .intro.fade-out {
      animation: introFadeOut 0.8s ease forwards;
    }
    @keyframes introFadeOut {
      to {
        opacity: 0;
        visibility: hidden;
      }
    }

    .app {
      width: 100%;
      max-width: 900px;
      margin: 8px auto 16px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      opacity: 0;
      pointer-events: none;
    }
    .app.visible {
      opacity: 1;
      pointer-events: auto;
      transition: opacity 0.6s ease;
    }

    .frame {
      position: relative;
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
    }

    .top-bar {
      width: 100%;
      height: 87px;
      background-image: url("top-bar.png");
      background-repeat: no-repeat;
      background-position: center top;
      background-size: 100% auto;
      pointer-events: none;
    }

    .content {
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 4px;
      transform-origin: center;
      margin-top: 64px;
      padding: 0 8px;
    }

    .q-label {
      font-size: 30px;
      color: #ffffff;
      text-align: center;
      text-shadow:
        0 0 6px rgba(255, 255, 255, 0.9),
        0 0 18px rgba(255, 255, 255, 0.9);
      margin-bottom: 2px; 
      display: none;
    }

    .q-text {
      font-size: 22px;
      line-height: 1.6;
      white-space: pre-wrap;
      text-align: center;
      margin-top: 0;  
    }

  
    .glow {
      text-shadow:
        0 0 6px rgba(255, 255, 255, 0.9),
        0 0 18px rgba(255, 255, 255, 0.9);
    }

    .red {
      color: #ff3058;
      text-shadow:
        0 0 6px rgba(255, 119, 155, 0.9),
        0 0 24px rgba(255, 40, 72, 0.95);
    }

    .blue {
      color: #3654ff;
      text-shadow:
        0 0 6px rgba(54, 84, 255, 0.9),
        0 0 18px rgba(54, 84, 255, 0.9);
    }

    .box-red {
      display: inline-block;
      padding: 16px 24px;
      border-radius: 14px;
      border: 1px solid rgba(255, 48, 88, 0.8);
      background: rgba(255, 48, 88, 0.08);
      margin-top: 24px;
    }

    .emph {
      font-weight: 700;
    }

    .choices {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-top: 60px;
    }

    .choice-btn {
      position: relative;
      display: flex;
      align-items: center;
      width: 100%;
      max-width: 700px;

      aspect-ratio: 3 / 1;
      height: auto;

      margin: 0 auto;
      border: none;
      border-radius: 0;
      padding: 4px 64px;
      text-align: left;
      font-size: 21px;
      cursor: pointer;
      color: #f5f6ff;
      background-color: transparent;
      background-image: url("frame.png");
      background-position: center;
      background-size: 100% 100%;
      background-repeat: no-repeat;
      outline: none;
      overflow: hidden;
      transform-origin: center;
    }

    /* ───── 불안한(위험한) 버튼 연출 ───── */
.choice-btn.ominous-btn {
  animation: ominousPulse 1.7s ease-in-out infinite;
}

/* 붉은 스캔 라인 */
.choice-btn.ominous-btn::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(
    to bottom,
    rgba(255, 70, 100, 0) 0%,
    rgba(255, 70, 100, 0.35) 50%,
    rgba(255, 70, 100, 0) 100%
  );
  mix-blend-mode: screen;
  opacity: 0;
  transform: translateY(-100%);
  pointer-events: none;
  animation: ominousScan 2.6s linear infinite;
}

/* 숨이 가빠지는 느낌 */
@keyframes ominousPulse {
  0% {
    transform: scale(1);
    filter: brightness(1) saturate(1);
    box-shadow: 0 0 0 rgba(255, 40, 72, 0);
  }
  40% {
    transform: scale(1.02);
    filter: brightness(1.05) saturate(1.2);
    box-shadow: 0 0 14px rgba(255, 40, 72, 0.55);
  }
  70% {
    transform: scale(0.99);
    filter: brightness(0.95) saturate(0.9);
    box-shadow: 0 0 4px rgba(255, 40, 72, 0.25);
  }
  100% {
    transform: scale(1);
    filter: brightness(1) saturate(1);
    box-shadow: 0 0 0 rgba(255, 40, 72, 0);
  }
}

/* 위 아래로 슬쩍 지나가는 불길한 빛 */
@keyframes ominousScan {
  0% {
    opacity: 0;
    transform: translateY(-120%);
  }
  20% {
    opacity: 1;
  }
  60% {
    opacity: 0.4;
    transform: translateY(40%);
  }
  100% {
    opacity: 0;
    transform: translateY(140%);
  }
}

    .choice-btn span {
      position: relative;
      z-index: 1;
      text-shadow:
        0 0 4px rgba(0, 0, 0, 0.9),
        0 0 12px rgba(0, 0, 0, 0.8);
      white-space: normal;
      word-break: keep-all;
      overflow: hidden;
      text-overflow: clip;

      margin-left: 30px;  /* 더 오른쪽 */
      margin-top: 6px;    /* 살짝 아래 */
    }

    .choice-btn::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(
        circle at 0 0,
        rgba(255, 255, 255, 0.18),
        transparent 55%
      );
      opacity: 0;
      transition: opacity 0.18s ease;
    }

    .choice-btn:hover::before {
      opacity: 0.4;
    }

    .choice-btn:active {
      transform: scale(0.97);
    }

    .choice-btn.red span {
      color: #ffdae2;
    }

    /* 질문 / 버튼 등장 애니메이션 */
    .question-enter {
      animation: questionIn 0.6s ease-out forwards;
    }
    @keyframes questionIn {
      from {
        opacity: 0;
        transform: scale(0.96);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .choices-enter .choice-btn {
      opacity: 0;
      transform: translateY(10px) scale(0.96);
      animation: btnPop 0.28s ease-out forwards;
    }
    @keyframes btnPop {
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .choices-hide {
      animation: choicesFadeOut 0.35s ease forwards;
    }
    @keyframes choicesFadeOut {
      to {
        opacity: 0;
        transform: translateY(6px);
      }
    }

    .fade-out {
      animation: textFadeOut 1s ease forwards;
    }
    @keyframes textFadeOut {
      to { opacity: 0; }
    }

    /* 지진 효과 */
    .shake {
      animation: shake 0.35s ease-in-out infinite;
    }
    @keyframes shake {
      0%   { transform: translate(0px, 0px); }
      25%  { transform: translate(-1px, 1px); }
      50%  { transform: translate(1px, -1px); }
      75%  { transform: translate(-1px, -1px); }
      100% { transform: translate(1px, 1px); }
    }

    /* 화면 암전 */
    .screen-dark {
      animation: fadeToBlack 2.2s ease forwards;
    }
    @keyframes fadeToBlack {
      to {
        background: #000;
        color: #aeb0ff;
      }
    }

    .hard-black {
      background: #000 !important;
      color: #000 !important;
      box-shadow: none !important;
      border-color: #000 !important;
    }

#msgOverlay.msg-overlay {
  position: fixed;
  inset: 0;
  z-index: 9999;

  display: none;               /* 기본은 숨김 (JS에서 flex로 켬) */
  justify-content: center;
  align-items: center;

  background: rgba(0, 0, 0, 0.92);

  opacity: 0;
  visibility: hidden;
  transition: opacity 0.2s ease, visibility 0.2s ease;
}

/* JS에서 class "show" 붙이면 보이게 */
#msgOverlay.msg-overlay.show {
  opacity: 1;
  visibility: visible;
}

#msgOverlay .msg-window {
  width: min(92vw, 560px);     /* 더크게 */
  border-radius: 18px;

  background: #000 !important;
  border: 1px solid rgba(255,255,255,0.85) !important;
  color: #fff !important;

  box-shadow:
    0 0 18px rgba(255,255,255,0.25),
    0 0 45px rgba(255,255,255,0.18),
    0 18px 60px rgba(0,0,0,0.95) !important;

  animation: msgGlowPulse 1.6s ease-in-out infinite;

  transform: translateY(6px) scale(0.98);
  transition: transform 0.2s ease;
}

#msgOverlay.show .msg-window {
  transform: translateY(0) scale(1);
}

#msgOverlay .msg-header {
  padding: 14px 16px;
  color: #fff !important;
  border-bottom: 1px solid rgba(255,255,255,0.18) !important;
  background: #000 !important;
  font-size: 16px;
  letter-spacing: 0.08em;
}

#msgOverlay .msg-body {
  padding: 16px 16px 18px;
  color: #fff !important;
  font-size: 18px;
  line-height: 1.6;
  white-space: pre-line;
}

#msgOverlay .msg-close {
  width: 100%;
  padding: 14px 16px;

  background: #fff !important;
  color: #000 !important;
  font-weight: 700;
  letter-spacing: 0.02em;

  border: 0;
  border-top: 1px solid rgba(255,255,255,0.18) !important;
  cursor: pointer;
}

#msgOverlay .msg-close:hover {
  background: rgba(255,255,255,0.92) !important;
}

@keyframes msgGlowPulse {
  0% {
    box-shadow:
      0 0 14px rgba(255,255,255,0.18),
      0 0 34px rgba(255,255,255,0.12),
      0 18px 60px rgba(0,0,0,0.95);
    transform: translateY(0);
  }
  55% {
    box-shadow:
      0 0 22px rgba(255,255,255,0.28),
      0 0 60px rgba(255,255,255,0.18),
      0 18px 60px rgba(0,0,0,0.95);
    transform: translateY(-1px);
  }
  100% {
    box-shadow:
      0 0 14px rgba(255,255,255,0.18),
      0 0 34px rgba(255,255,255,0.12),
      0 18px 60px rgba(0,0,0,0.95);
    transform: translateY(0);
  }
}

    /* 모바일 전용 */
    @media (max-width: 480px) {

      body {
        padding: 0 6px 8px;
      }

      .top-bar {
        height: 83px;
        background-size: 100% auto;
        background-position: center top;
      }

      .content {
        margin-top: 75px;
        padding: 0 4px;
      }

      .q-label {
        font-size: 24px;
        margin-bottom: 4px;
      }

      .q-text {
        font-size: 20px;
        margin-top: 0;
      }

      .choices {
        gap: 3px;
        margin-top: 80px;
      }

      .choice-btn {
        max-width: 100%;
        aspect-ratio: 4.3 / 1;
        height: auto;
        padding: 4px 32px;
        font-size: 15px;
        background-size: 100% 100%;
      }

      .choice-btn span {
        margin-left: 22px;
        position: relative;
        top: 1.5px;
        line-height: 1.3;
      }
    }
  </style>
</head>

<body>
  <audio id="sfxIntro" src="sfx-intro.mp3" preload="auto"></audio>
  <audio id="bgm" src="bgm.mp3" preload="auto" loop></audio>
  <audio id="voice" src="voice.mp3" preload="auto"></audio>
<audio id="sfxHit" src="sfx-hit.mp3" preload="auto"></audio>
  
  <div class="intro" id="intro">
    <div class="intro-text">연결합니다</div>
  </div>

  <div class="app" id="app">
    <div class="frame" id="frame">
      <div class="top-bar"></div>

      <div class="content" id="content">
        <div class="q-label glow" id="qLabel"></div>
        <div class="q-text glow" id="qText"></div>
        <div class="choices" id="choices"></div>
      </div>
    </div>
  </div>

  <!-- 엔딩 메시지 오버레이 -->
  <div class="msg-overlay" id="msgOverlay">
    <div class="msg-window">
      <div class="msg-header">SYSTEM MESSAGE</div>
    <div class="msg-body" id="msgBody">
에러 발생!
"gateway 0"과의 연결이 끊겼습니다.
    </div>
      <button class="msg-close" id="msgClose">확인</button>
    </div>
  </div>

  <script>
       // 오디오
    const bgmEl    = document.getElementById("bgm");
    const voiceEl  = document.getElementById("voice");
    const sfxHitEl = document.getElementById("sfxHit");
    const sfxIntroEl = document.getElementById("sfxIntro");

    function playIntroSfx() {
  if (!sfxIntroEl) return;
  sfxIntroEl.volume = 0.9;
  sfxIntroEl.currentTime = 0;
  sfxIntroEl.play().catch(() => {
    const resume = () => {
      sfxIntroEl.currentTime = 0;
      sfxIntroEl.play().catch(() => {});
      document.removeEventListener("click", resume);
      document.removeEventListener("touchstart", resume);
    };
    document.addEventListener("click", resume, { once: true });
    document.addEventListener("touchstart", resume, { once: true });
  });
}
    
    function tryStartBgm() {
      if (!bgmEl) return;
     // bgmEl.volume = 0.7;
      bgmEl.play().catch(() => {
        const resume = () => {
          bgmEl.play().catch(() => {});
          document.removeEventListener("click", resume);
          document.removeEventListener("touchstart", resume);
        };
        document.addEventListener("click", resume);
        document.addEventListener("touchstart", resume);
      });
    }

    // 브금 꺼버리기
    function hardStopBgm() {
      if (!bgmEl) return;
      bgmEl.pause();
      bgmEl.currentTime = 0;  // 되감기
    }

    // 브금 페이드 아웃
    function fadeOutBgm(durationMs = 1500) {
      if (!bgmEl) return;

      const startVolume = bgmEl.volume ?? 0.7;
      const steps = 20;
      const stepTime = durationMs / steps;
      let currentStep = 0;

      const fadeTimer = setInterval(() => {
        currentStep++;
        const t = currentStep / steps;
        const v = startVolume * (1 - t);
        bgmEl.volume = Math.max(0, v);

        if (currentStep >= steps) {
          clearInterval(fadeTimer);
          bgmEl.pause();
          bgmEl.currentTime = 0;
          bgmEl.volume = startVolume; // 다시 켤때를 위해 원상복귀
        }
      }, stepTime);
    }

    // 효과음 한번 재생
    function playHitSfx() {
      if (!sfxHitEl) return;
      sfxHitEl.currentTime = 0;
      sfxHitEl.play().catch(() => {});
    }

    // 브금 다시 켜기
    function resumeBgm(volume = 0.7) {
      if (!bgmEl) return;
      bgmEl.volume = volume;
      bgmEl.play().catch(() => {});
    }

  function fadeInBgm(durationMs = 1500, targetVolume = 0.7) {
  if (!bgmEl) return;

  bgmEl.play().catch(() => {});

  const steps = 20;
  const stepTime = durationMs / steps;
  const startVolume = bgmEl.volume ?? 0;
  let currentStep = 0;

  const fadeTimer = setInterval(() => {
    currentStep++;
    const t = currentStep / steps;
    const v = startVolume + (targetVolume - startVolume) * t;
    bgmEl.volume = Math.min(targetVolume, Math.max(0, v));

    if (currentStep >= steps) {
      clearInterval(fadeTimer);
      bgmEl.volume = targetVolume;
    }
  }, stepTime);
}
    
    const BUTTON_DELAY_MS = 1200;

    // 스토리 노드
  const NODES = {
  q0: {
    id: "q0",
    label: "",
    type: "typewriter",
    typeSpeedMs: 195,
    fontSize: 23,
    text: "[pause][pause][pause]...들리십니까?",
    delayMs: 2000,
    options: [
      { label: "네", next: "q0_success" },
      { label: "아니오", next: "q0_regret" }
    ]
  },

  q0_success: {
    id: "q0_success",
    label: "",
    type: "typewriter",
    typeSpeedMs: 190,
    fontSize: 23,
    text: "[pause][pause]성공적으로\n[pause]연결 되었습니다.",
    autoNext: "q0_start",
    autoDelayMs: 2000
  },

  q0_regret: {
    id: "q0_regret",
    label: "",
    blue: true,
    type: "typewriter",
    typeSpeedMs: 180,
    fontSize: 23,
    text: "[pause]유감이군요.",
    autoNext: "q0_start",
    autoDelayMs: 2000
  },

  q0_start: {
    id: "q0_start",
    label: "",
    type: "typewriter",
    typeSpeedMs: 185,
    fontSize: 22,
    text: "[pause]그러면...[pause]\n바로 질문을 시작하도록 할까요.",
    autoNext: "q1",
    autoDelayMs: 2000
  },

  q1: {
    id: "q1",
    label: "Q1",
    type: "typewriter",
    typeSpeedMs: 170,
    fontSize: 23,
    text: "[pause][pause]당신은 누구입니까?",
    delayMs: 2000,
    options: [
      { label: "...", next: "q1_r1" },
      { label: "답하지 않는다.", next: "q1_r2" }
    ]
  },

  q1_r1: {
    id: "q1_r1",
    label: "",
    type: "typewriter",
    typeSpeedMs: 180,
    fontSize: 23,
    text: "[pause]...머뭇거리고 계시는군요.",
    autoNext: "q2",
    autoDelayMs: 2000
  },

  q1_r2: {
    id: "q1_r2",
    label: "",
    type: "typewriter",
    typeSpeedMs: 180,
    fontSize: 23,
    text: "[pause]...대답이 없으시군요.",
    autoNext: "q2",
    autoDelayMs: 2000
  },

  q2: {
    id: "q2",
    label: "Q2",
    type: "typewriter",
    typeSpeedMs: 170,
    fontSize: 22,
    text: "[pause]지금 [pause]말을 걸고 있는 존재가\n누구인지 알고 있습니까?[pause]",
    delayMs: 2000,
    options: [
      { label: "알고 있습니다.", next: "q2_1" },
      { label: "...잘 모르겠습니다.", next: "q2_unknown" }
    ]
  },

  q2_unknown: {
    id: "q2_unknown",
    label: "",
    type: "typewriter",
    typeSpeedMs: 180,
    fontSize: 23,
    text: "[pause]좋습니다.",
    autoNext: "q3",
    autoDelayMs: 2000
  },

  q2_1: {
    id: "q2_1",
    label: "",
    red: true,
    type: "typewriter",
    typeSpeedMs: 250,
    fontSize: 24,
    text: "...[pause]확실합니까?",
    delayMs: 2000,
    options: [
      { label: "네, 저는 당신이 누군지 알아요.", next: "q2_2" },
      { label: "사실 잘 모르겠습니다.", next: "q3" },
      { label: "글쎄요...", next: "q3" }
    ]
  },

  q2_2: {
    id: "q2_2",
    label: "",
    red: true,
    type: "typewriter",
    typeSpeedMs: 65,
    fontSize: 21,
    boxRed: true,
    glitch: true,
    shake: true,
    text:
      "서 버  로 그  데 이 터 를  바 탕 으 로 \n당 신 의  기 억 정 상 여 부 를 \n재 점 검 합 니 다.",
    autoNext: "q2_2_cut",
    autoDelayMs: 4000
  },

  q2_2_cut: {
    id: "q2_2_cut",
    label: "",
    red: true,
    fontSize: 35,
    boxRed: true,
    text: "<점검 완료>",
    autoNext: "q3",
    autoDelayMs: 4000
  },

  q3: {
    id: "q3",
    label: "Q3",
    type: "typewriter",
    typeSpeedMs: 160,
    fontSize: 22,
    text: "[pause][pause]당신에게는 소중한 사람이나\n가족이 있습니까?[pause]",
    delayMs: 2000,
    options: [
      { label: ".....", next: "q4" },
      { label: "답하지 않는다.", next: "q4" }
    ]
  },

  q4: {
    id: "q4",
    label: "Q4",
    type: "typewriter",
    typeSpeedMs: 150,
    fontSize: 20,
    text:
      "[pause][pause]당신의 소중한 사람이 눈앞에서\n죽어가고 있을 때,\n살릴 수 있는 방법을 알게 된다면[pause]\n살리시겠습니까?[pause]\n방관하시겠습니까?",
    delayMs: 2000,
    options: [
      { label: "어떻게든 살려낸다.", next: "q4_r1" },
      { label: "살리지 않는다.", next: "q4_r2" }, // Q5 감정으로 우회
      { label: "서서히 죽어가도록 내버려둔다.", next: "q4_r3", isThird: true }
    ]
  },

  q4_r1: {
    id: "q4_r1",
    label: "",
    type: "typewriter",
    typeSpeedMs: 200,
    fontSize: 23,
    text: ".[pause].[pause].[pause]\n그렇군요.[pause] 당신은 그렇군요.",
    autoNext: "q5",
    autoDelayMs: 4000
  },

  q4_r2: {
    id: "q4_r2",
    label: "",
    type: "typewriter",
    typeSpeedMs: 200,
    fontSize: 23,
    text: ".[pause].[pause].[pause]\n그렇군요.[pause]\n당신은 그렇군요.",
    autoNext: "q5_alt", // 감정 Q5
    autoDelayMs: 4000
  },

  q4_r3: {
    id: "q4_r3",
    label: "",
    red: true,
    fontSize: 25,
    text: "데이터에 이상이 감지되었습니다!",
    noEnterAnim: true,
    cornerText: true, 
    stopBgmHard: true,
    hideTopBar: true,
    autoNext: "q5",
    autoDelayMs: 4000
  },

  q5: {
    id: "q5",
    label: "Q5",
    type: "typewriter",
    typeSpeedMs: 150,
    fontSize: 20,
    text:
      "[pause][pause]소중한 사람이 계속해서 죽어갈 때마다 \n다시 살려낼 것 입니까? \n[pause]아니면, 죽어가도록 내버려두겠습니까?",
    delayMs: 2000,
    startBgm: true,
    options: [
      {
        label: "소중한 사람을 잃고 싶지 않아요.\n어떻게든 끝까지 노력해서 살려낼 것 같아요.",
        next: "q6"
      },
      {
        label: "그냥...포기한 채로, 내버려둘 것 같아요.",
        next: "q6"
      },
      {
        label: "딱히 관심 없어요. 아무렇지도 않을 것 같아요.",
        next: "q6",
        isThird: true
      }
    ]
  },

  q5_alt: {
    id: "q5_alt",
    label: "Q5",
    type: "typewriter",
    typeSpeedMs: 170,
    fontSize: 20,
    text: "[pause]살리지 않기로 결정했습니다.\n당신은 어떤 느낌이 드십니까?",
    delayMs: 2000,
    options: [
      { label: "공포", next: "q6" },
      { label: "안도감", next: "q6" },
      { label: "죄책감", next: "q6" },
      { label: "통쾌함", next: "q6", isThird: true }
    ]
  },

  q6: {
    id: "q6",
    label: "Q6",
    type: "typewriter",
    typeSpeedMs: 150,
    fontSize: 21,
    text:
      "[pause][pause]어떤 방식이든 가능하기만 하다면,[pause]\n삶을 끝없이 이어 붙일 수 있다고\n생각하십니까?",
    delayMs: 2000,
    options: [
      { label: "...그럴 수는 없을거에요.", next: "q7" },
      {
        label: "네, 분명히요.\n언젠가는 그런 경험을 하게 될 날이 오기를 바라고 있어요.",
        next: "q7"
      },
      { label: "그런 거엔 관심이 없습니다.", next: "q7", isThird: true }
    ]
  },

  q7: {
    id: "q7",
    label: "Q7",
    type: "typewriter",
    typeSpeedMs: 170,
    fontSize: 22,
    text: "[pause][pause]당신에게 있어, ‘죽음’이란 무엇입니까?",
    delayMs: 2000,
    options: [
      { label: " 단 하나의 종료 버튼이에요.", next: "q8" },
      { label: "모든 것의 종착점이자, 멋진 완결 페이지에요.", next: "q8" },
      { label: "생명이 기능을 정지하는 것이라고 생각해요.", next: "q8" },
      { label: "늘 두려워하는 거에요.", next: "q8", isThird: true }
    ]
  },

  q8: {
    id: "q8",
    label: "Q8",
    type: "typewriter",
    typeSpeedMs: 150,
    fontSize: 21,
    text:
      "[pause][pause]몸이 없더라도,\n스스로 의식을 가진 개체에게[pause]\n‘생명’이라는 말을 사용할 수 있습니까?",
    delayMs: 2000,
    options: [
      { label: "네, 그럴 수 있다고 생각해요.", next: "q9_life" },
      { label: "아니요...그래도 그건 생명이라고 부르기 어렵습니다.", next: "q9_entity" }
    ]
  },

q9_life: {
  id: "q9_life",
  label: "Q9",
  fontSize: 23,
  text:
    "당신의 기억과 동기화된\n작은 데이터 생명체의\n생성여부를 확인해보시겠습니까?",
  delayMs: 2000,
  options: [
    { label: "좋아요!", next: "q9_1_life" },
    { label: "사양할게요..", next: "q9_no" }
  ],
  fadeOutBgmMs: 1200
},

q9_entity: {
  id: "q9_entity",
  label: "Q9",
  fontSize: 23,
  text:
    "당신의 기억과 동기화된\n작은 데이터 개체의\n생성여부를 확인해보시겠습니까?",
  delayMs: 2000,
  options: [
    { label: "좋아요!", next: "q9_1_entity" },
    { label: "사양할게요..", next: "q9_no" }
  ],
  fadeOutBgmMs: 1200
},

q9_1_life: {
  id: "q9_1_life",
  label: "",
  type: "typewriter",
  typeSpeedMs: 170,
  fontSize: 20,
  text:
    "[pause][pause]여기-[pause] 당신의 생명체가\n이 곳을 벗어나기 위해,\n애원하며 많은 질문을 던져옵니다.[pause][pause]\n이 생명체를 삭제할 권리가\n당신에게 있다고 생각하십니까?",
  delayMs: 2000,
  options: [
    { label: "네, 그건 제가 만든 생명체이니까요.", next: "q9_interesting" },
    { label: "아니요, 온전히 제 것이라고 설명하기 어렵습니다.", next: "q9_understood" }
  ],
  startBgm: true
},

q9_1_entity: {
  id: "q9_1_entity",
  label: "",
  type: "typewriter",
  typeSpeedMs: 170,
  fontSize: 20,
  text:
    "[pause][pause]여기-[pause] 당신의 데이터 개체가\n이 곳을 벗어나기 위해,\n애원하며 많은 질문을 던져옵니다.[pause][pause]\n이 개체를 삭제할 권리가\n당신에게 있다고 생각하십니까?",
  delayMs: 2000,
  options: [
    { label: "네, 그건 제가 만든 개체이니까요.", next: "q9_interesting" },
    { label: "아니요, 온전히 제 것이라고 설명하기 어렵습니다.", next: "q9_understood" }
  ],
  startBgm: true
},

  q9_no: {
    id: "q9_no",
    label: "",
    red: true,
    type: "typewriter",
    typeSpeedMs: 160,
    text: "잘 이해했습니다.",
    autoNext: "q10",
    autoDelayMs: 2000,
    startBgm: true
  },

  q9_understood: {
    id: "q9_understood",
    label: "",
    red: true,
    type: "typewriter",
    typeSpeedMs: 160,
    text: "잘 이해했습니다.",
    autoNext: "q10",
    autoDelayMs: 2000
  },

  q9_interesting: {
    id: "q9_interesting",
    label: "",
    red: true,
    type: "typewriter",
    typeSpeedMs: 190,
    text: "[pause][pause]점점 흥미로워집니다.",
    autoNext: "q10",
    autoDelayMs: 2000
  },

  q10: {
    id: "q10",
    label: "",
    type: "typewriter",
    typeSpeedMs: 170,
    fontSize: 23,
    text: "[pause][pause]마지막으로....[pause]\n당신은 자신이 어떤 존재인지\n알고 있습니까?[pause]",
    delayMs: 2000,
    options: [
      { label: "저는 제가 어떤 존재인지 꽤 명확히 이해하고 있습니다.", next: "lastQ" },
      { label: "...저는 단 하나의 말로 정의하기 어렵습니다.", next: "lastQ" },
      { label: "......솔직히, 잘 모르겠습니다.", next: "lastQ", isThird: true }
    ]
  },

  bonus: {
    id: "bonus",
    label: "",
    type: "typewriter",
    typeSpeedMs: 15,
    fontSize: 35,
    shake: true,
    text:
      "당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니ㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲ",
    autoNext: "lastQ",
    autoDelayMs: 4000
  },

  lastQ: {
    id: "lastQ",
    label: "",
    red: true,
    type: "typewriter",
    typeSpeedMs: 5,
    fontSize: 27,
    shake: true,
    text:
      "당҈̘̩̝͚̣̞͚̰͍̘͉̣̙̤̩̰̰͍̭̮̱͚̲̊̾͛̊̍̀͌̌̑͛͂̉̎ͅ신̶̲̱̞̙͚͉͉͇͇̪̪̞̱̖̥͙̳͎̓̍̓̆̉̎̄͗͊̄̀̇̾̈̋̽̍͒̊ͅ은҉̘̟͚̠͍̩̞̰͚̳͖̤̣̜̘̫̮̈̏̓̾̎̒̆̇̀͛̌̂̀̏́̐͐̑̚ 자҈̳̠͎͈̞͈̱̭̪̬̥̯͉̰̮̮͍̀̌͒̿̆͛͑̈͆̿̽̿͊͐̄̇̐̍̚신̸̤̣̜̤̰̮͔̘̱̟̱̞̆̉̽̌́̑̏̀̀̈̉̂́̍͑́이̴̘̪̗̱͉̥͙͔̰̥͈͉̞͔̫̫̳́̅͆͊̎̑͗͒̎́͗̈͆̇̌̑̀ͅ 어̷̲̲̮̪͓͇̠̭̳͕͙̗̪̖͓͖̯̯͈̓͛̋̆̔̇̔̑̒͛̐̍̓̒̅̑̚떤̶̤̰̫͚̰͎̯̞̩̯͈̟̦̩̖̅̔̎̉͐̅̀̊̆̉͒͑́̄̏̒͐ 존̵͔͎̭̦͕̗͈̖̮͙͕͇̏̋͋̌̏́̀́̉̏͂͆̽̓̈̓͛͆̀̏͂̄재̸͇̥̗̤͇̥̣̮̤̦̥̮͚͕̞͔͚̲̟̏̍̂̿̈́̔̀̃͛͆̇͑͛͒̓̔̃̍̐̒̿̚인̵̥̦͎͇̟̣̖͕͇͉̰͚̯͔͖͓͓͇̩͚͍̣̣̖̆̉͌͑̅͌͂͗͐́̑̽̾̾̀̊̆́̇͊̈́̽͒지̵̖͇̳̫̪̜̭̦̬͖̳͇̫̣̘̜̙͎̲̟̔͆͆͛͛̊́͑͗̆͆͋̀͆̆̆͗̎̊͛͌̇̀̚ 알҉̭̱͈̮̫͓̲̫͉͚̬̥̝̫̣͙̬̮͊́̄̄̏̀̓̇̽̋̐͐̆̎고̴̭͖͇̪̭̥̦̳̜̲̲̭̱͚̙͍̬͇̬̳̎̒̒̿͆̈́̅̅̂̆̀͊̎ 있҈̮̠̥̦̥̟͕̯̤͔͙͔̊̉̐̃̓͌̈̏̐̈̌̿̇̇̀̆͆̿̏͐̎̀̀습҉͖̟̘̳̙̲̪̖̟̱̘̦̳̜͔̩̜̭͈̉͑̓̇́̉̄̌̐́̒̌̀̿͆̇̒̌̽̂̉̃͒니҈̤̭̫̰̪͈͙͉̦̦̬̰̲̩̍̎͂͌͋͌̓̄̓̃̍́͋̿̀̑͋̊ͅ까̷͓̟͍̣̪͙̞͔͓̳̦̞͖̩̯͈̘̦̝̄̎̇̀̎͑̐͛͋̃́͌͂̉͆̍͆̒̃̈́ͮ?",
    delayMs: 5000,
    options: [
      { label: "?̵?̴?̵", next: "end1", red: true, ominous: true },
      { label: "?̧̥͙̗̯̤̳̯̗͕̲ͅ?̡͈͖̱͙̲?̨͇̱̱̥̞̰͉̯̣̭ͅ", next: "end1", red: true, ominous: true },
      { label: "???", next: "end1", red: true, ominous: true }
    ]
  },

 end1: {
  id: "end1",
  label: "",
  type: "typewriter",
  typeSpeedMs: 173,
  fontSize: 23,
  text: "[pause]협조해 주셔서 감사합니다.[pause]\n응답기록을 모두 보관하였습니다.[pause]\n당신의 데이터 검사가 완료되었습니다-",
  autoNext: "end2", 
  autoDelayMs: 3000
},

end2: {
  id: "end2",
  label: "",
  type: "typewriterRich", 
  fontSize: 24,

  segments: [
    { text: "[pause][pause][pause]당신의 새로운 몸ㅇ", className: "glow", speed: 100 },

    { pauseMs: 600 },

    { action: "stopBgmHard" },

    { text: "ㅇ[pause]ㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇ\nError.",
     className: "red",
     speed: 10
    }
  ],

  autoNext: "end_swap",
  autoDelayMs: 3000
},
end_swap: {
  id: "end_swap",
  label: "",
  fontSize: 24,
  text: "대상 교체를 시작합니다.\n이전 개체와의 연결을 종료합니다.",
  autoNext: "end3",
  autoDelayMs: 3800
},

end3: {
  id: "end3",
  label: "",
  text: "",
  finalBlack: true
},
  };

    const appEl     = document.getElementById("app");
    const frameEl   = document.getElementById("frame");
    const topBarEl = document.querySelector(".top-bar");
    const contentEl = document.getElementById("content");
    const qLabelEl  = document.getElementById("qLabel");
    const qTextEl   = document.getElementById("qText");
    const choicesEl = document.getElementById("choices");

    const msgOverlay = document.getElementById("msgOverlay");
    const msgClose   = document.getElementById("msgClose");
    
    if (msgOverlay) {
  msgOverlay.classList.remove("show");
  msgOverlay.style.display = "none";
}

    function openMsgOverlay() {
      if (!msgOverlay) return;
      if (msgOverlay.classList.contains("show")) return;
      document.body.style.overflow = "hidden";
  msgOverlay.style.display = "flex";
  requestAnimationFrame(() => msgOverlay.classList.add("show"));
}

function closeMsgOverlay() {
  if (!msgOverlay) return;
  msgOverlay.classList.remove("show");
  setTimeout(() => {
    msgOverlay.style.display = "none";
    document.body.style.overflow = "";
  }, 300);
}
    
 if (msgClose && msgOverlay) {
  msgClose.addEventListener("click", () => {
    closeMsgOverlay();
  });
  msgOverlay.addEventListener("click", (e) => {
    if (e.target === msgOverlay) {
      closeMsgOverlay();
    }
  });
}

    let currentId = "q0";
    let timerId = null;
    let typingTimer = null;
    let transitioning = false;
    let thirdChoiceCount = 0;
    let bonusTriggered = false;

    function clearTimers() {
      if (timerId) {
        clearTimeout(timerId);
        timerId = null;
      }
      if (typingTimer) {
        clearInterval(typingTimer);
        typingTimer = null;
      }
    }

    function renderChoices(node) {
      choicesEl.innerHTML = "";
      choicesEl.classList.remove("choices-hide", "choices-enter");

      if (!node.options || !node.options.length) return;

      choicesEl.classList.add("choices-enter");
      node.options.forEach((opt, index) => {
        const btn = document.createElement("button");
        btn.className = "choice-btn";
        
        if (opt.red) btn.classList.add("red");

        if (opt.ominous) btn.classList.add("ominous-btn");
        
        btn.style.animationDelay = `${0.05 * index}s`;

        const span = document.createElement("span");
        span.textContent = opt.label;
        btn.appendChild(span);

        btn.addEventListener("click", () => handleChoice(node, opt));
        choicesEl.appendChild(btn);
      });
    }

  function renderNode(id) {
    clearTimers();
    transitioning = false;

    const node = NODES[id];
    if (!node) return;

    currentId = id;

    // top bar
    if (topBarEl) {
      topBarEl.classList.toggle("topbar-hidden", !!node.hideTopBar);
    }

    // audio triggers
    if (node.stopBgmHard) hardStopBgm();
    if (node.fadeOutBgmMs) fadeOutBgm(node.fadeOutBgmMs);
    if (node.playSfx === "hit") playHitSfx();
    if (node.startBgm) resumeBgm();

    // Q label
    if (node.label) {
      qLabelEl.textContent = node.label;
      qLabelEl.style.display = "block";
    } else {
      qLabelEl.textContent = "";
      qLabelEl.style.display = "none";
    }

    // reset styles
    qTextEl.className = "q-text glow";
    qTextEl.classList.remove("error-corner", "box-red", "flicker", "glitch", "pressure-text");
    frameEl.classList.remove("shake");
    qTextEl.style.fontSize = (node.fontSize || 25) + "px";

    // colors / effects
    if (node.red) qTextEl.classList.add("red");
    if (node.blue) qTextEl.classList.add("blue");
    if (node.boxRed) qTextEl.classList.add("box-red");
    if (node.shake) frameEl.classList.add("shake");
    if (node.flicker) qTextEl.classList.add("flicker");
    if (node.glitch) qTextEl.classList.add("glitch");
    if (node.pressure) qTextEl.classList.add("pressure-text");

    // corner style
    if (node.cornerText) {
      qTextEl.classList.add("error-corner");
      qTextEl.classList.remove("glow", "red", "blue");
    }

    // render text
    if (node.type === "typewriterRich") {
      qTextEl.textContent = "";
      choicesEl.innerHTML = "";
      choicesEl.classList.remove("choices-hide", "choices-enter");
      startTypewriterRich(node);

    } else if (node.type === "typewriter") {
      qTextEl.textContent = "";
      choicesEl.innerHTML = "";
      choicesEl.classList.remove("choices-hide", "choices-enter");
      startTypewriter(node);

    } else {
      qTextEl.innerHTML = (node.text || "").replace(/\n/g, "<br>");
      renderChoices(node);
    }

    // enter animation
    if (!node.noEnterAnim) {
      contentEl.classList.remove("question-enter");
      void contentEl.offsetWidth;
      contentEl.classList.add("question-enter");
    } else {
      contentEl.classList.remove("question-enter");
    }

    // ✅ typing 노드는 autoNext를 각 타자 함수 내부에서 처리
    const isTyping = node.type === "typewriter" || node.type === "typewriterRich";
    if (isTyping) return;

    // final black (ending)
    if (node.finalBlack) {
      frameEl.classList.add("hard-black");
      document.body.classList.add("screen-dark");
      choicesEl.innerHTML = "";
      qTextEl.textContent = "";

      if (bgmEl) {
        bgmEl.pause();
        bgmEl.currentTime = 0;
      }

      if (voiceEl) {
        voiceEl.play().catch(() => {});
      }

      setTimeout(() => openMsgOverlay(), 250);
      
      // prevent duplicate button
      const oldBtn = contentEl.querySelector(".ending-msg-btn");
      if (oldBtn) oldBtn.remove();

      const msgBtn = document.createElement("button");
      msgBtn.className = "choice-btn ending-msg-btn";
      msgBtn.style.marginTop = "92px";

      const span = document.createElement("span");
      span.textContent = "누르시겠습니까?";
      msgBtn.appendChild(span);

      msgBtn.addEventListener("click", () => {
  playHitSfx();      // 버튼 툭
  openMsgOverlay();  // 에러창 뜸
});
      
      contentEl.appendChild(msgBtn);

      return;
    }

    // normal autoNext (non-typing)
    if ((!node.options || !node.options.length) && node.autoNext) {
      timerId = setTimeout(() => {
        renderNode(node.autoNext);
      }, node.autoDelayMs || 1700);
    }
  }

    function handleChoice(node, opt) {
  if (transitioning) return;
  transitioning = true;

      
    if (opt.isThird) {
      thirdChoiceCount++;
    }

    choicesEl.classList.add("choices-hide");

    let nextId = opt.next;

    if (opt.isThird && thirdChoiceCount >= 3 && !bonusTriggered) {
      nextId = "bonus";
      bonusTriggered = true;
    }

    const wait = node.delayMs || 2000;

    timerId = setTimeout(() => {
      choicesEl.innerHTML = "";
      choicesEl.classList.remove("choices-hide");
      renderNode(nextId);
    }, wait);
  }

  function startTypewriterRich(node) {
    const segments = node.segments || [];
    let segIndex = 0;

    const PAUSE_TOKEN = "[pause]";
    const PAUSE_TIME  = 800;

    if (typingTimer) {
      clearInterval(typingTimer);
      typingTimer = null;
    }

    qTextEl.innerHTML = "";

    function finishNode() {
      if (node.options && node.options.length) {
        setTimeout(() => renderChoices(node), BUTTON_DELAY_MS);
      }

      if (node.autoNext) {
        const delay = node.autoDelayMs || 1700;
        timerId = setTimeout(() => renderNode(node.autoNext), delay);
      }
    }

    function runNextSegment() {
      if (segIndex >= segments.length) {
        finishNode();
        return;
      }

      const seg = segments[segIndex];

      // pause segment
      if (seg.pauseMs) {
        setTimeout(() => {
          segIndex++;
          runNextSegment();
        }, seg.pauseMs);
        return;
      }

      // action segment
      if (seg.action === "stopBgmHard") {
        hardStopBgm();
        segIndex++;
        runNextSegment();
        return;
      }

      // text segment
      const span = document.createElement("span");
      if (seg.className) span.classList.add(seg.className);
      qTextEl.appendChild(span);

      const full  = seg.text || "";
      const speed = seg.speed ?? node.typeSpeedMs ?? 60;
      let index = 0;

      function tick() {
        if (index >= full.length) {
          clearInterval(typingTimer);
          typingTimer = null;
          segIndex++;
          runNextSegment();
          return;
        }

        if (full.slice(index, index + PAUSE_TOKEN.length) === PAUSE_TOKEN) {
          index += PAUSE_TOKEN.length;
          clearInterval(typingTimer);
          typingTimer = null;

          setTimeout(() => {
            typingTimer = setInterval(tick, speed);
          }, PAUSE_TIME);

          return;
        }

        index++;
        span.textContent = full.slice(0, index).replaceAll(PAUSE_TOKEN, "");
      }

      typingTimer = setInterval(tick, speed);
    }

    runNextSegment();
  }

  function startTypewriter(node) {
    const full  = node.text || "";
    let index   = 0;
    const speed = node.typeSpeedMs || 60;

    const PAUSE_TOKEN = "[pause]";
    const PAUSE_TIME  = 800;

    function tick() {
      if (index >= full.length) {
        clearInterval(typingTimer);
        typingTimer = null;

        if (node.options && node.options.length) {
          setTimeout(() => {
            renderChoices(node);
          }, BUTTON_DELAY_MS);
        }

        if (node.autoNext) {
          const delay = node.autoDelayMs || 1700;
          timerId = setTimeout(() => {
            renderNode(node.autoNext);
          }, delay);
        }

        return;
      }

      if (full.slice(index, index + PAUSE_TOKEN.length) === PAUSE_TOKEN) {
        index += PAUSE_TOKEN.length;
        clearInterval(typingTimer);
        typingTimer = null;

        setTimeout(() => {
          typingTimer = setInterval(tick, speed);
        }, PAUSE_TIME);

        return;
      }

      index++;
      const visible = full.slice(0, index).replaceAll(PAUSE_TOKEN, "");
      qTextEl.innerHTML = visible.replace(/\n/g, "<br>");
    }

    typingTimer = setInterval(tick, speed);
  }

  const introEl = document.getElementById("intro");

  window.addEventListener("load", () => {
    playIntroSfx();

    bgmEl.volume = 0;
    tryStartBgm();

    setTimeout(() => {
      introEl.classList.add("fade-out");
      setTimeout(() => {
        introEl.style.display = "none";
        appEl.classList.add("visible");

        renderNode("q0");
        fadeInBgm(1800, 0.7);
      }, 800);
    }, 5000);
  });
</script>
</body>
</html>















