<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex,nofollow" />
  <title>connection</title>

  <style>
    * {
      box-sizing: border-box;
    }
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    body {
      background: #000;
      color: #f5f5ff;
      font-family: -apple-system, system-ui, "Apple SD Gothic Neo",
        "Noto Sans KR", sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start;   /* 화면 맨 위로 붙이기 */
      min-height: 100vh;
      overflow-y: auto;
      padding: 8px;
    }

    /* 인트로 화면 */
    .intro {
      position: fixed;
      inset: 0;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }
    .intro-text {
      font-size: 22px;
      letter-spacing: 0.3em;
      color: #f5f5ff;
      text-shadow:
        0 0 8px rgba(255, 255, 255, 0.9),
        0 0 22px rgba(54, 84, 255, 0.9);
      animation: introPulse 1.2s ease-in-out infinite alternate;
    }
    @keyframes introPulse {
      from { opacity: 0.4; }
      to   { opacity: 1; }
    }
    .intro.fade-out {
      animation: introFadeOut 0.8s ease forwards;
    }
    @keyframes introFadeOut {
      to {
        opacity: 0;
        visibility: hidden;
      }
    }

    /* 본 화면 컨테이너 */
    .app {
      width: 100%;
      max-width: 900px;
      margin: 8px auto 16px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      opacity: 0;
      pointer-events: none;
    }
    .app.visible {
      opacity: 1;
      pointer-events: auto;
      transition: opacity 0.6s ease;
    }

    /* 프레임: 그냥 레이아웃 박스 (배경X) */
    .frame {
      position: relative;
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
    }

    /* 맨 위 HUD 바 = top-bar.png */
    .top-bar {
      width: 100%;
      height: 80px; /* 세로 고정 → 안 찌그러지게 */
      background-image: url("top-bar.png");
      background-repeat: no-repeat;
      background-position: center top;
      background-size: contain;
      pointer-events: none;
    }

    .content {
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 24px;
      transform-origin: center;
      margin-top: 52px; /* HUD 밑으로 살짝 내리기 */
      padding: 0 8px;
    }

    /* Q번호: Q1~Q6에서만 사용, 질문과 같은 크기/색/글로우 */
    .q-label {
      font-size: 20px;
      color: #ffffff;
      text-align: center;
      margin-bottom: 8px;
      text-shadow:
        0 0 6px rgba(255, 255, 255, 0.9),
        0 0 18px rgba(54, 84, 255, 0.9);
      display: none; /* 노드에서 필요할 때만 켬 */
    }

    /* 질문 텍스트 */
    .q-text {
      font-size: 20px;
      line-height: 1.6;
      white-space: pre-wrap;
      text-align: center;
      margin-top: 4px;
    }

    /* 기본 네온 글로우 */
    .glow {
      text-shadow:
        0 0 6px rgba(255, 255, 255, 0.9),
        0 0 18px rgba(54, 84, 255, 0.9);
    }

    /* 빨간 네온 텍스트 */
    .red {
      color: #ff3058;
      text-shadow:
        0 0 6px rgba(255, 119, 155, 0.9),
        0 0 24px rgba(255, 40, 72, 0.95);
    }

    /* 파란 네온 텍스트 (유감이군요 / 보너스 등) */
    .blue {
      color: #3654ff;
      text-shadow:
        0 0 6px rgba(54, 84, 255, 0.9),
        0 0 18px rgba(54, 84, 255, 0.9);
    }

    /* 선택지 전체 컨테이너 */
    .choices {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin-top: 30px;
    }

    /* 버튼 자체가 frame.png 한 장 */
    .choice-btn {
      position: relative;
      display: flex;
      align-items: center;
      width: 100%;
      max-width: 720px;      /* 너무 넓지 않게 */
      height: 64px;          /* 세로 두께 고정 */
      margin: 0 auto;
      border: none;
      border-radius: 0;
      padding: 0 32px;
      text-align: left;
      font-size: 15px;
      cursor: pointer;
      color: #f5f6ff;
      background-color: transparent;
      background-image: url("frame.png");
      background-position: center;
      background-size: 100% 100%;
      background-repeat: no-repeat;
      outline: none;
      overflow: hidden;
      transform-origin: center;
    }

    .choice-btn span {
      position: relative;
      z-index: 1;
      text-shadow:
        0 0 4px rgba(0, 0, 0, 0.9),
        0 0 12px rgba(0, 0, 0, 0.8);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .choice-btn::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(
        circle at 0 0,
        rgba(255, 255, 255, 0.18),
        transparent 55%
      );
      opacity: 0;
      transition: opacity 0.18s ease;
    }

    .choice-btn:hover::before {
      opacity: 0.4;
    }

    .choice-btn:active {
      transform: scale(0.97);
    }

    .choice-btn.red span {
      color: #ffdae2;
    }

    /* 질문 / 버튼 등장 애니메이션 */
    .question-enter {
      animation: questionIn 0.6s ease-out forwards;
    }
    @keyframes questionIn {
      from {
        opacity: 0;
        transform: scale(0.96);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .choices-enter .choice-btn {
      opacity: 0;
      transform: translateY(10px) scale(0.96);
      animation: btnPop 0.28s ease-out forwards;
    }
    @keyframes btnPop {
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .choices-hide {
      animation: choicesFadeOut 0.35s ease forwards;
    }
    @keyframes choicesFadeOut {
      to {
        opacity: 0;
        transform: translateY(6px);
      }
    }

    /* END 단계에서 전체 암전 */
    .screen-dark {
      animation: fadeToBlack 2.2s ease forwards;
    }
    @keyframes fadeToBlack {
      to {
        background: #000;
        color: #aeb0ff;
      }
    }

    /* 완전 검은 화면 전환용 */
    .hard-black {
      background: #000 !important;
      color: #000 !important;
      box-shadow: none !important;
      border-color: #000 !important;
    }

    /* 모바일 대응 */
    @media (max-width: 480px) {
      .top-bar {
        height: 64px;
      }
      .content {
        margin-top: 40px;
        padding: 0 4px;
      }
      .q-text {
        font-size: 18px;
      }
      .q-label {
        font-size: 18px;
      }
      .choice-btn {
        height: 60px;
        padding: 0 20px;
        font-size: 14px;
      }
    }
  </style>
</head>

<body>
  <!-- 배경 BGM (파일명: bgm.mp3 로 업로드) -->
  <audio id="bgm" src="bgm.mp3" preload="auto" loop></audio>
  <!-- 마지막 보이스 (파일명: voice.mp3 로 업로드) -->
  <audio id="voice" src="voice.mp3" preload="auto"></audio>

  <!-- 인트로: "연결합니다" -->
  <div class="intro" id="intro">
    <div class="intro-text">연결합니다</div>
  </div>

  <!-- 질문 화면 -->
  <div class="app" id="app">
    <div class="frame" id="frame">
      <div class="top-bar"></div>

      <div class="content" id="content">
        <div class="q-label glow" id="qLabel"></div>
        <div class="q-text glow" id="qText"></div>
        <div class="choices" id="choices"></div>
      </div>
    </div>
  </div>

  <script>
    // ----------------------------
    // 오디오: 자동재생 우회
    // ----------------------------
    const bgmEl = document.getElementById("bgm");
    const voiceEl = document.getElementById("voice");

    function tryStartBgm() {
      if (!bgmEl) return;
      bgmEl.volume = 0.7;
      bgmEl.play().catch(() => {
        const resume = () => {
          bgmEl.play().catch(() => {});
          document.removeEventListener("click", resume);
          document.removeEventListener("touchstart", resume);
        };
        document.addEventListener("click", resume);
        document.addEventListener("touchstart", resume);
      });
    }

    // ----------------------------
    // 스토리 노드 정의
    // type: "typewriter" -> 한 글자씩 출력
    // typeSpeedMs: 타자 속도(ms/글자)
    // delayMs: 버튼 클릭 후 다음 노드까지 지연 (기본 2000ms)
    // autoNext / autoDelayMs: 버튼 없는 노드 자동 진행
    // red / blue: 텍스트 색상
    // isThird: 3번 선택지 카운트용
    // ----------------------------

    const NODES = {
      // 0번 질문 (...들리십니까?)
      q0: {
        id: "q0",
        label: "", // Q 없음
        type: "typewriter",
        typeSpeedMs: 170, // 0.18초
        text: "...들리십니까?",
        delayMs: 2000,
        options: [
          { label: "네", next: "q1" },
          { label: "아니오", next: "q0_regret" }
        ]
      },

      // 0-1 반응: 유감이군요.
      q0_regret: {
        id: "q0_regret",
        label: "",
        blue: true,
        type: "typewriter",
        typeSpeedMs: 170,
        text: "유감이군요.",
        autoNext: "q1",
        autoDelayMs: 2000
      },

      // 1번 질문: Q1
      q1: {
        id: "q1",
        label: "Q1",
        text: "당신은 누구입니까?",
        delayMs: 2000,
        options: [
          { label: "...", next: "q1_react" }
        ]
      },

      // 1번 질문 이후 반응
      q1_react: {
        id: "q1_react",
        label: "",
        type: "typewriter",
        typeSpeedMs: 170,
        text: "...대답이 없으시군요.",
        autoNext: "q2",
        autoDelayMs: 2000
      },

      // 2번 질문: Q2
      q2: {
        id: "q2",
        label: "Q2",
        text: "당신은 제가 누구인지 알고 있습니까?",
        delayMs: 2000,
        options: [
          { label: "알고 있어요.", next: "q2_1" },
          { label: "잘 모르겠어요.", next: "q3" }
        ]
      },

      // 2-1 질문: ....확실합니까? (Q 표시는 없음!)
      q2_1: {
        id: "q2_1",
        label: "",       // <= Q2-1 안 뜨게
        red: true,
        type: "typewriter",
        typeSpeedMs: 250,
        text: "....확실합니까?",
        delayMs: 2000,
        options: [
          { label: "네, 저는 당신이 누군지 알아요.", next: "q2_2" },
          { label: "사실 잘 모르겠습니다.", next: "q3" },
          { label: "글쎄요...", next: "q3" }
        ]
      },

      // 2-2 반응
      q2_2: {
        id: "q2_2",
        label: "",
        red: true,
        type: "typewriter",
        typeSpeedMs: 120,
        text:
"서 버  로 그  데 이 터 를 바 탕 으 로\n당 신 의  기 억 정 상 여 부 를  재 검 토 합 니 다.",
        autoNext: "q2_2_cut",
        autoDelayMs: 4000
      },

      // 2-2 전용 컷: 검토 완료
      q2_2_cut: {
        id: "q2_2_cut",
        label: "",
        red: true,
        type: "typewriter",
        typeSpeedMs: 200,
        text: "<검토 완료>",
        autoNext: "q3",
        autoDelayMs: 4000
      },

      // 3번 질문: Q3
      q3: {
        id: "q3",
        label: "Q3",
        text:
"당신의 소중한 사람이 눈앞에서 죽어가고 있을 때,\n그를 다시 되살릴 수 있는 방법이 있다면\n살리겠습니까, 아니면 방관하시겠습니까?",
        delayMs: 2000,
        options: [
          { label: "어떻게든 살려낸다.", next: "q3_r1" },
          { label: "살리지 않는다.",     next: "q3_r2" },
          { label: "서서히 죽어가도록 내버려둔다.", next: "q3_r3", isThird: true }
        ]
      },

      // 3번 질문 반응들
      q3_r1: {
        id: "q3_r1",
        label: "",
        type: "typewriter",
        typeSpeedMs: 200,
        text: "그렇군요. 당신은 그렇군요.",
        autoNext: "q4",
        autoDelayMs: 4000
      },
      q3_r2: {
        id: "q3_r2",
        label: "",
        type: "typewriter",
        typeSpeedMs: 200,
        text: "그렇군요. 당신은 그렇군요.",
        autoNext: "q4",
        autoDelayMs: 4000
      },
      q3_r3: {
        id: "q3_r3",
        label: "",
        red: true,
        type: "typewriter",
        typeSpeedMs: 70,
        text:
"Error Error Error Error Error Error \nError Error Error\nError Error Error \nError Error Error Error Error Error\nError Error Error Error Error Error",
        autoNext: "q4",
        autoDelayMs: 4000
      },

      // 4번 질문: Q4
      q4: {
        id: "q4",
        label: "Q4",
        text:
"소중한 사람이 죽을 때마다 다시 살려낼 것 입니까?\n아니면, 또다시 서서히 죽어가도록 내버려두겠습니까?",
        delayMs: 2000,
        options: [
          {
            label: "소중한 사람을 잃고 싶지 않아요. 어떻게든 끝까지 노력해서 살려낼 겁니다.",
            next: "q5"
          },
          {
            label: "그냥..포기하고, 죽어가게 내버려둘 겁니다.",
            next: "q5"
          },
          {
            label: "딱히 관심 없어요. 아무렇지도 않을 것 같아요.",
            next: "q5",
            isThird: true
          }
        ]
      },

      // 5번 질문: Q5
      q5: {
        id: "q5",
        label: "Q5",
        text:
"어떤 방식이든 가능하기만 하다면,\n계속해서 삶을 이어갈 수 있다고 생각하십니까?",
        delayMs: 2000,
        options: [
          { label: "...그럴 수는 없죠.", next: "q6" },
          {
            label: "네, 분명히요. 언젠가는 그런 경험을 하게 될 날이 올 거라고 믿어요.",
            next: "q6"
          },
          {
            label: "그런 거엔 관심이 없어요.",
            next: "q6",
            isThird: true
          }
        ]
      },

      // 6번 질문: Q6
      q6: {
        id: "q6",
        label: "Q6",
        type: "typewriter",
        typeSpeedMs: 200,
        text:
"마지막으로.... 당신은 자신이 어떤 존재인지 알고 있습니까?",
        delayMs: 4000,
        options: [
          {
            label: "저는 제가 어떤 존재인지 완벽히 이해하고 있습니다.",
            next: "lastQ"
          },
          {
            label: "...저는 단 하나로는 정의하기 어렵습니다.",
            next: "lastQ"
          },
          {
            label: "......잘 모르겠습니다.",
            next: "lastQ",
            isThird: true
          }
        ]
      },

      // 보너스 씬 (3번 선택 3회 이상일 때)
      bonus: {
        id: "bonus",
        label: "",
        red: true,
        type: "typewriter",
        typeSpeedMs: 70,
        text:
"당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니까? 당신이 알고 있는 건 무엇입니ㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲㄲ",
        autoNext: "lastQ",
        autoDelayMs: 4000
      },

      // 마지막 질문
      lastQ: {
        id: "lastQ",
        label: "",
        red: true,
        type: "typewriter",
        typeSpeedMs: 20, // 더 빠른 글리치
        text:
"당҈̘̩̝͚̣̞͚̰͍̘͉̣̙̤̩̰̰͍̭̮̱͚̲̊̾͛̊̍̀͌̌̑͛͂̉̎ͅ신̶̲̱̞̙͚͉͉͇͇̪̪̞̱̖̥͙̳͎̓̍̓̆̉̎̄͗͊̄̀̇̾̈̋̽̍͒̊ͅ은҉̘̟͚̠͍̩̞̰͚̳͖̤̣̜̘̫̮̈̏̓̾̎̒̆̇̀͛̌̂̀̏́̐͐̑̚ 자҈̳̠͎͈̞͈̱̭̪̬̥̯͉̰̮̮͍̀̌͒̿̆͛͑̈͆̿̽̿͊͐̄̇̐̍̚신̸̤̣̜̤̰̮͔̘̱̟̱̞̆̉̽̌́̑̏̀̀̈̉̂́̍͑́이̴̘̪̗̱͉̥͙͔̰̥͈͉̞͔̫̫̳́̅͆͊̎̑͗͒̎́͗̈͆̇̌̑̀ͅ 어̷̲̲̮̪͓͇̠̭̳͕͙̗̪̖͓͖̯̯͈̓͛̋̆̔̇̔̑̒͛̐̍̓̒̅̑̚떤̶̤̰̫͚̰͎̯̞̩̯͈̟̦̩̖̅̔̎̉͐̅̀̊̆̉͒͑́̄̏̒͐ 존̵͔͎̭̦͕̗͈̖̮͙͕͇̏̋͋̌̏́̀́̉̏͂͆̽̓̈̓͛͆̀̏͂̄재̸͇̥̗̤͇̥̣̮̤̦̥̮͚͕̞͔͚̲̟̏̍̂̿̈́̔̀̃͛͆̇͑͛͒̓̔̃̍̐̒̿̚인̵̥̦͎͇̟̣̖͕͇͉̰͚̯͔͖͓͓͇̩͚͍̣̣̖̆̉͌͑̅͌͂͗͐́̑̽̾̾̀̊̆́̇͊̈́̽͒지̵̖͇̳̫̪̜̭̦̬͖̳͇̫̣̘̜̙͎̲̟̔͆͆͛͛̊́͑͗̆͆͋̀͆̆̆͗̎̊͛͌̇̀̚ 알҉̭̱͈̮̫͓̲̫͉͚̬̥̝̫̣͙̬̮͊́̄̄̏̀̓̇̽̋̐͐̆̎고̴̭͖͇̪̭̥̦̳̜̲̲̭̱͚̙͍̬͇̬̳̎̒̒̿͆̈́̅̅̂̆̀͊̎ 있҈̮̠̥̦̥̟͕̯̤͔͙͔̊̉̐̃̓͌̈̏̐̈̌̿̇̇̀̆͆̿̏͐̎̀̀습҉͖̟̘̳̙̲̪̖̟̱̘̦̳̜͔̩̜̭͈̉͑̓̇́̉̄̌̐́̒̌̀̿͆̇̒̌̽̂̉̃͒니҈̤̭̫̰̪͈͙͉̦̦̬̰̲̩̍̎͂͌͋͌̓̄̓̃̍́͋̿̀̑͋̊ͅ까̷͓̟͍̣̪͙̞͔͓̳̦̞͖̩̯͈̘̦̝̄̎̇̀̎͑̐͛͋̃́͌͂̉͆̍͆̒̃̈́ͮ?",
        delayMs: 5000,
        options: [
          { label: "?̵?̴?̵", next: "end1", red: true },
          { label: "?̧̥͙̗̯̤̳̯̗͕̲ͅ?̡͈͖̱͙̲?̨͇̱̱̥̞̰͉̯̣̭ͅ", next: "end1", red: true },
          { label: "???", next: "end1", red: true }
        ]
      },

      // 최종 반응 01
      end1: {
        id: "end1",
        label: "",
        type: "typewriter",
        typeSpeedMs: 180,
        text: "협조해 주셔서 감사합니다.\n당신의 데이터 검사가 완료되었습니다-",
        autoNext: "end2",
        autoDelayMs: 3000
      },

      // 최종 반응 02 : Error
      end2: {
        id: "end2",
        label: "",
        red: true,
        type: "typewriter",
        typeSpeedMs: 110,
        text: "당신의ㅣㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇ\nError.",
        autoNext: "end3",
        autoDelayMs: 3000
      },

      // 최종 반응 03 : 완전 암전 + 보이스
      end3: {
        id: "end3",
        label: "",
        text: "",
        finalBlack: true
      }
    };

    // ----------------------------
    // 렌더링 / 상태
    // ----------------------------
    const appEl     = document.getElementById("app");
    const frameEl   = document.getElementById("frame");
    const contentEl = document.getElementById("content");
    const qLabelEl  = document.getElementById("qLabel");
    const qTextEl   = document.getElementById("qText");
    const choicesEl = document.getElementById("choices");

    let currentId = "q0";
    let timerId = null;
    let typingTimer = null;
    let transitioning = false;
    let thirdChoiceCount = 0; // 3번 선택 누적

    function clearTimers() {
      if (timerId) {
        clearTimeout(timerId);
        timerId = null;
      }
      if (typingTimer) {
        clearInterval(typingTimer);
        typingTimer = null;
      }
    }

    function renderChoices(node) {
      choicesEl.innerHTML = "";
      choicesEl.classList.remove("choices-hide", "choices-enter");

      if (!node.options || !node.options.length) return;

      choicesEl.classList.add("choices-enter");
      node.options.forEach((opt, index) => {
        const btn = document.createElement("button");
        btn.className = "choice-btn";
        if (opt.red) btn.classList.add("red");
        btn.style.animationDelay = `${0.05 * index}s`;

        const span = document.createElement("span");
        span.textContent = opt.label;
        btn.appendChild(span);

        btn.addEventListener("click", () => handleChoice(node, opt));
        choicesEl.appendChild(btn);
      });
    }

    function renderNode(id) {
      clearTimers();
      transitioning = false;
      const node = NODES[id];
      if (!node) return;
      currentId = id;

      // Q 라벨 표시 (Q1~Q6만 label이 있음)
      if (node.label) {
        qLabelEl.textContent = node.label;
        qLabelEl.style.display = "block";
      } else {
        qLabelEl.textContent = "";
        qLabelEl.style.display = "none";
      }

      // 색상 클래스
      qTextEl.classList.add("glow");
      qTextEl.classList.remove("red", "blue");
      if (node.red)  qTextEl.classList.add("red");
      if (node.blue) qTextEl.classList.add("blue");

      // 텍스트/타자
      if (node.type === "typewriter") {
        qTextEl.textContent = "";
        choicesEl.innerHTML = "";
        choicesEl.classList.remove("choices-hide", "choices-enter");
        startTypewriter(node);
      } else {
        qTextEl.innerHTML = (node.text || "").replace(/\n/g, "<br>");
        renderChoices(node);
      }

      // 질문 등장 애니메이션
      contentEl.classList.remove("question-enter");
      void contentEl.offsetWidth;
      contentEl.classList.add("question-enter");

      // 타입라이터 아닌 자동 진행 노드
      if (node.type !== "typewriter") {
        if ((!node.options || !node.options.length) && node.autoNext) {
          timerId = setTimeout(() => {
            renderNode(node.autoNext);
          }, node.autoDelayMs || 1700);
        } else if (node.finalBlack) {
          frameEl.classList.add("hard-black");
          document.body.classList.add("screen-dark");
          choicesEl.innerHTML = "";
          qTextEl.textContent = "";
          if (voiceEl) {
            voiceEl.play().catch(() => {});
          }
        }
      }
    }

    function handleChoice(node, opt) {
      if (transitioning) return;
      transitioning = true;

      // 3번 선택 카운트
      if (opt.isThird) {
        thirdChoiceCount++;
      }

      // 버튼 페이드아웃
      choicesEl.classList.add("choices-hide");

      // 다음 노드 결정
      let nextId = opt.next;
      if (node.id === "q6" && opt.isThird && thirdChoiceCount >= 3) {
        nextId = "bonus";
      }

      const wait = node.delayMs || 2000;

      timerId = setTimeout(() => {
        choicesEl.innerHTML = "";
        choicesEl.classList.remove("choices-hide");
        renderNode(nextId);
      }, wait);
    }

    function startTypewriter(node) {
      const full = node.text || "";
      let index = 0;
      const speed = node.typeSpeedMs || 60;

      typingTimer = setInterval(() => {
        index++;
        if (index > full.length) {
          clearInterval(typingTimer);
          typingTimer = null;

          // 버튼 있는 노드: 타이핑 끝난 후에만 페이드인
          if (node.options && node.options.length) {
            setTimeout(() => {
              renderChoices(node);
            }, 200); // 살짝 숨 고르고 등장
          }

          // 자동 진행
          if (node.autoNext) {
            const delay = node.autoDelayMs || 1700;
            timerId = setTimeout(() => {
              renderNode(node.autoNext);
            }, delay);
          }
          return;
        }
        qTextEl.innerHTML = full.slice(0, index).replace(/\n/g, "<br>");
      }, speed);
    }

    // ----------------------------
    // 인트로 → 본 화면 시작
    // ----------------------------
    const introEl = document.getElementById("intro");

    window.addEventListener("load", () => {
      tryStartBgm();

      // 5초 동안 "연결합니다" 유지 후 질문으로
      setTimeout(() => {
        introEl.classList.add("fade-out");
        setTimeout(() => {
          introEl.style.display = "none";
          appEl.classList.add("visible");
          renderNode("q0");
        }, 800);
      }, 5000);
    });
  </script>
</body>
</html>
