<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex,nofollow" />
  <title>newlove / questionnaire</title>

  <style>
    * { box-sizing:border-box; }
    html, body {
      height:100%;
      margin:0;
    }
    body{
      background:#020308;
      color:#f5f5ff;
      font-family: ui-sans-serif, system-ui, -apple-system, "Apple SD Gothic Neo", "Noto Sans KR", sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      overflow:hidden;
    }
    .overlay {
      position:fixed;
      inset:0;
      background:radial-gradient(circle at 0 0, #252542 0, #020308 55%);
      opacity:0.85;
      z-index:-1;
    }
    .frame{
      width:min(92vw, 720px);
      max-height:92vh;
      background:rgba(5,5,18,.95);
      border-radius:18px;
      border:1px solid rgba(140,140,255,.25);
      box-shadow:0 24px 70px rgba(0,0,0,.9);
      padding:22px 22px 18px;
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    .header{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      font-size:13px;
      color:#9da0ff;
      letter-spacing:.05em;
    }
    .header-title{
      font-weight:700;
    }
    .header-sub{
      color:#666a9a;
      font-size:11px;
    }

    .question-no{
      font-size:12px;
      color:#8c8fff;
      letter-spacing:.12em;
      text-transform:uppercase;
    }
    .question-text{
      font-size:20px;
      line-height:1.5;
      margin-top:4px;
      white-space:pre-wrap;
    }

    .choices{
      margin-top:18px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .choice-btn{
      width:100%;
      border-radius:999px;
      border:1px solid rgba(180,180,255,.35);
      background:rgba(15,15,35,.95);
      color:#f5f5ff;
      padding:12px 18px;
      text-align:left;
      font-size:14px;
      cursor:pointer;
      transition:background .12s ease, transform .06s ease, box-shadow .12s ease;
    }
    .choice-btn:hover{
      background:rgba(40,40,80,1);
      box-shadow:0 0 18px rgba(140,140,255,.4);
    }
    .choice-btn:active{
      transform:translateY(1px);
      box-shadow:none;
    }

    .system-text{
      margin-top:14px;
      font-size:12px;
      color:#666a9a;
      line-height:1.5;
    }
    .system-text b{
      color:#dcdcff;
    }

    .footer{
      margin-top:12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:11px;
      color:#52557a;
    }

    .glitch {
      color:#ff4b7a;
      text-shadow:
        0 0 3px rgba(255,75,122,.8),
        -2px 0 3px rgba(0,255,255,.35),
        2px 0 3px rgba(0,0,0,.8);
    }
    .screen-dark {
      animation: fadeToBlack 3s forwards;
    }
    @keyframes fadeToBlack{
      to { background:#000; color:#b6b6ff; }
    }
  </style>
</head>

<body>
  <div class="overlay"></div>

  <div class="frame" id="frame">
    <div class="header">
      <div>
        <div class="header-title">NEWLOVE / INPUT TEST</div>
        <div class="header-sub" id="subtitle">응답을 선택해 진행하세요.</div>
      </div>
      <div><span id="stepLabel">STEP 1</span></div>
    </div>

    <div>
      <div class="question-no" id="qNo">Q1</div>
      <div class="question-text" id="qText">...</div>
    </div>

    <div class="choices" id="choiceBox"></div>

    <div class="system-text" id="systemHint">
      일부 인앱 브라우저에서는 오작동이 발생할 수 있습니다. 문제가 생기면 <b>우측 상단 ⋮ → “다른 브라우저로 열기”</b>로 다시 시도해 주세요.
    </div>

    <div class="footer">
      <span>NODE: <span id="nodeIdView">q1</span></span>
      <span>world: newlove-questionnaire</span>
    </div>
  </div>

  <!-- 마지막에 재생할 보이스 파일 (파일 이름은 자유롭게 바꿔도 됨) -->
  <!-- 같은 리포지토리에 voice.mp3 를 올려두면 됨 -->
  <audio id="voice" src="voice.mp3" preload="auto"></audio>

  <script>
    // ===== 스토리 노드 정의 =====
    // id: 화면 이름
    // text: 질문/문장
    // options: [{ label, next, reaction }]  reaction은 잠깐 보여줄 문장(선택지 4번 반응용)

    const NODES = {
      q1: {
        id: "q1",
        label: "Q1",
        text: `...들리십니까?`,
        options: [
          { label: "네", next: "q2" },
          { label: "아니오", next: "q2" }
        ]
      },
      q2: {
        id: "q2",
        label: "Q2",
        text: `“당신은 누구십니까?”`,
        options: [
          { label: "...", next: "q3" }
        ]
      },
      q3: {
        id: "q3",
        label: "Q3",
        text: `“당신은 제가 누구인지 알고있습니까?”`,
        options: [
          { label: "알고있어요.", next: "q3_1" },
          { label: "잘 모르겠어요.", next: "q4" }
        ]
      },
      q3_1: {
        id: "q3_1",
        label: "Q3-1",
        text: `“....확실합니까?"`,
        options: [
          { label: "네, 저는 당신이 누군지 알아요.", next: "q4" },
          { label: "사실 잘 모르겠습니다.", next: "q4" },
          { label: "글쎄요...", next: "q4" }
        ]
      },
      q4: {
        id: "q4",
        label: "Q4",
        text: `“만약 당신의 소중한 사람이 눈앞에서 죽어간다면,
하지만 다시 되살릴 수 있다면 살리겠습니까, 방관하시겠습니까?”`,
        options: [
          {
            label: "어떻게든 살려낸다.",
            next: "q5",
            reaction: "그렇군요. 당신은 그렇군요."
          },
          {
            label: "살리지 않는다.",
            next: "q5",
            reaction: "그렇군요. 당신은 그렇군요."
          },
          {
            label: "서서히 죽어가도록 내버려둔다.",
            next: "q5",
            reaction: `Error Error Error Error Error Error
Error Error Error
Error Error Error
Error Error Error Error Error Error`,
            glitch: true
          }
        ]
      },
      q5: {
        id: "q5",
        label: "Q5",
        text: `“당신은 소중한 사람이 죽을 때마다 살려낼 것 입니까?
아니면, 또다시 서서히 죽어가게 내버려두겠습니까?”`,
        options: [
          {
            label: "소중한 사람을 잃고 싶지 않아요. 어떻게든 끝까지 노력해서 살려낼 겁니다.",
            next: "q6"
          },
          {
            label: "이젠 포기하고, 죽어가게 내버려둘 겁니다.",
            next: "q6"
          },
          {
            label: "딱히 관심 없어요. 아무렇지도 않을 것 같아요.",
            next: "q6"
          }
        ]
      },
      q6: {
        id: "q6",
        label: "Q6",
        text: `“어떤 방식이든 가능하기만 하다면,
계속해서 삶을 이어갈 수 있다고 생각하십니까?”`,
        options: [
          { label: "...그럴 수는 없죠.", next: "q7" },
          { label: "네, 분명히요. 언젠가는 그런 경험을 하게 될 날이 올 거라고 믿어요.", next: "q7" },
          { label: "그런 거엔 관심이 없어요.", next: "q7" }
        ]
      },
      q7: {
        id: "q7",
        label: "Q7",
        text: `“마지막으로.... 당신은 자신이 어떤 존재인지 알고 있습니까?”`,
        options: [
          { label: "저는 제가 어떤 존재인지 완벽히 이해하고 있습니다.", next: "END" },
          { label: "...저는 단 하나로는 정의하기 어렵습니다.", next: "END" },
          { label: "......잘 모르겠습니다.", next: "END" }
        ]
      }
    };

    // ===== 상태 =====
    let currentId = "q1";

    const qNoEl = document.getElementById("qNo");
    const qTextEl = document.getElementById("qText");
    const choiceBox = document.getElementById("choiceBox");
    const stepLabel = document.getElementById("stepLabel");
    const nodeIdView = document.getElementById("nodeIdView");
    const frameEl = document.getElementById("frame");
    const voiceEl = document.getElementById("voice");

    function renderNode(id){
      const node = NODES[id];
      if(!node){ return; }
      currentId = id;

      qNoEl.textContent = node.label;
      qTextEl.classList.remove("glitch");
      qTextEl.textContent = node.text;
      stepLabel.textContent = "STEP " + node.label.replace("Q","");
      nodeIdView.textContent = node.id;

      choiceBox.innerHTML = "";
      node.options.forEach(opt => {
        const btn = document.createElement("button");
        btn.className = "choice-btn";
        btn.textContent = opt.label;
        btn.addEventListener("click", () => handleChoice(node, opt));
        choiceBox.appendChild(btn);
      });
    }

    function handleChoice(node, opt){
      // Q4에서만 반응 문장 출력
      if (opt.reaction){
        qTextEl.textContent = opt.reaction;
        choiceBox.innerHTML = "";
        if (opt.glitch){
          qTextEl.classList.add("glitch");
        }
        setTimeout(() => {
          renderNode(opt.next);
        }, 1700);
        return;
      }

      // 마지막 질문 이후 END
      if (opt.next === "END"){
        showEnding();
        return;
      }

      renderNode(opt.next);
    }

    function showEnding(){
      qNoEl.textContent = "END";
      qTextEl.classList.add("glitch");
      qTextEl.innerHTML =
        `“협조에 감사를 드립니다.<br>` +
        `당신의 데이터 키트 제작이 완료되었습니다.”<br><br>` +
        `<span class="glitch">당신의ㅣㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇㅇ<br>Error.</span>`;

      choiceBox.innerHTML = "";
      stepLabel.textContent = "COMPLETE";
      nodeIdView.textContent = "end";

      // 화면 서서히 암전
      document.body.classList.add("screen-dark");

      // 보이스 재생 시도 (사용자 클릭 직후라 성공할 확률 높음)
      if (voiceEl){
        voiceEl.play().catch(() => {
          // 못 틀어도 조용히 무시
        });
      }
    }

    // 시작
    renderNode(currentId);
  </script>
</body>
</html>
